# 家庭照片管理系统 - 系统概述

**作者**: 汪玮芸  
**创建日期**: 2025-06-25  
**最后更新**: 2025-06-25
**文档状态**: 已归档
**文档版本**: V0.1

[![文档版本](https://img.shields.io/badge/docs-v1.3-blue.svg)](docs/家庭照片管理系统.md)

## 1. 项目概述

家庭照片管理系统是一个专为家庭设计的照片管理平台，旨在解决以下痛点问题：

- **照片分散问题**：一家人拍摄的照片，散落在不同的手机、电脑和云存储服务中，难以统一管理
- **长辈使用障碍**：大部分照片管理产品对长辈不友好，功能复杂，操作困难
- **隐私担忧**：将照片上传至第三方云服务，存在隐私泄露风险
- **无法持续备份**：常见的"拍完就忘"模式，导致重要记忆没有及时备份

系统采用模块化的 Flask Web 应用架构，提供直观的用户界面和安全可靠的照片存储服务，让家庭成员能便捷地：

- 将照片备份至加密的私有云，确保照片安全
- 查看全家人上传的照片，分享美好瞬间
- 无需记住复杂密码，通过手机验证码快速访问
- 随时通过网页查看全家的照片库

## 2. 目标用户

- **主要用户**：家庭组织者（通常是30-45岁的父母），负责创建家庭空间并邀请其他家人加入
- **次要用户**：
  - 家中长辈（60岁以上）：浏览家庭照片的被动使用者，需要简单易用的界面
  - 青少年子女：偶尔上传照片，主要用于查看家庭照片库

## 3. 核心功能

### 3.1 用户认证模块
- **手机验证码登录**：无需记住复杂密码，使用手机验证码即可登录/注册
- **会话管理**：30天内保持登录状态，超时需重新验证

### 3.2 家庭空间模块
- **创建家庭**：用户可创建专属家庭空间，自动成为管理员
- **邀请码加入**：通过唯一邀请码邀请家人加入共享空间
- **家庭成员管理**：查看成员列表，管理成员权限

### 3.3 照片管理模块
- **照片上传**：支持单张/多张照片上传，显示上传进度
- **瀑布流展示**：按时间倒序展示照片，支持下拉刷新和无限滚动
- **全屏浏览**：点击缩略图进入全屏模式，左右滑动切换照片
- **照片信息**：显示照片基本信息（上传者、拍摄时间等）

### 3.4 相册管理模块
- **创建相册**：用户可创建自定义相册，为相册命名和添加描述
- **相册编辑**：修改相册名称、描述，设置封面照片
- **照片归类**：将照片添加到一个或多个相册中，支持批量操作
- **相册浏览**：查看相册列表和相册内照片，支持瀑布流浏览

### 3.5 标签功能模块（V0.2）
- **创建标签**：用户可创建自定义标签，标签在家庭内共享
- **照片打标签**：为照片添加一个或多个标签，在照片查看界面显示
- **标签管理**：查看所有标签列表，显示每个标签下的照片数量

### 3.6 智能检索模块（V0.2）
- **按时间检索**：选择日期范围筛选照片，提供日期选择器界面
- **按上传者检索**：按照上传者筛选照片，显示家庭成员列表供选择
- **关键词搜索**：通过文件名关键词和标签关键词搜索照片

## 4. 技术架构

### 4.1 技术栈
- **前端**：HTML + CSS + JavaScript (原生)
- **后端**：Python + Flask (模块化架构)
- **数据库**：SQLite
- **ORM框架**：SQLAlchemy
- **存储**：本地文件系统
- **部署**：直接运行 Python 脚本，支持 Gunicorn/uWSGI + Nginx 生产环境部署

### 4.2 系统架构
系统采用模块化的三层架构设计：

1. **模型层 (Model)**：定义数据结构和数据库操作
   - 位置：`models/` 目录
   - 职责：封装数据库操作，提供数据访问接口

2. **服务层 (Service)**：实现业务逻辑
   - 位置：`services/` 目录
   - 职责：处理复杂业务逻辑，协调多个模型的操作

3. **路由层 (Route)**：处理HTTP请求和响应
   - 位置：`routes/` 目录
   - 职责：定义API端点，处理请求参数，调用服务层，返回响应

4. **工具层 (Utils)**：提供通用功能支持
   - 位置：`utils/` 目录
   - 职责：提供数据库连接、文件处理、图像处理等通用功能

### 4.3 模块依赖关系
```
routes → services → models → utils/db
```

- 路由层依赖业务逻辑层，不直接访问数据模型
- 业务逻辑层依赖数据模型层，实现核心功能
- 数据模型层依赖数据库工具，实现数据持久化
- 工具层不依赖其他层，提供基础功能

### 4.4 应用工厂模式
系统使用应用工厂模式创建Flask应用实例，实现了更好的模块化和可测试性：

```python
# 导入应用工厂
from home_photo import create_app

# 创建应用实例
app = create_app()  # 默认使用'default'配置
# 或者指定配置
app = create_app('development')  # 使用开发环境配置
app = create_app('testing')      # 使用测试环境配置
app = create_app('production')   # 使用生产环境配置
```

## 5. 项目结构

```
home_photo/
├── models/             # 数据模型层
│   ├── __init__.py
│   ├── user.py         # 用户相关模型
│   ├── family.py       # 家庭相关模型
│   ├── photo.py        # 照片相关模型
│   ├── album.py        # 相册相关模型
│   ├── tag.py          # 标签相关模型
│   └── comment.py      # 评论相关模型
├── routes/             # 路由层
│   ├── __init__.py
│   ├── auth.py         # 认证相关路由
│   ├── family.py       # 家庭管理路由
│   ├── photos.py       # 照片管理路由
│   ├── albums.py       # 相册管理路由
│   ├── tags.py         # 标签管理路由
│   ├── comments.py     # 评论相关路由
│   ├── stats.py        # 统计相关路由
│   └── pages.py        # 页面渲染路由
├── services/           # 业务逻辑层
│   ├── __init__.py
│   ├── auth_service.py # 认证相关业务逻辑
│   ├── family_service.py # 家庭管理业务逻辑
│   ├── photo_service.py # 照片管理业务逻辑
│   ├── album_service.py # 相册管理业务逻辑
│   ├── tag_service.py  # 标签管理业务逻辑
│   ├── comment_service.py # 评论管理业务逻辑
│   └── stats_service.py # 统计相关业务逻辑
├── utils/              # 工具函数
│   ├── __init__.py
│   ├── db.py           # 数据库工具
│   ├── file_utils.py   # 文件处理工具
│   ├── image_utils.py  # 图像处理工具
│   └── security.py     # 安全相关工具
├── static/             # 静态资源
│   ├── css/
│   ├── js/
│   └── images/
├── templates/          # HTML模板
├── tests/              # 测试代码
│   ├── unit/           # 单元测试
│   ├── integration/    # 集成测试
│   └── e2e/            # 端到端测试
├── storage/            # 上传的照片存储目录
├── config.py           # 配置管理
├── db.py               # 数据库连接管理
├── __init__.py         # 应用工厂
├── app.py              # 应用入口点
├── schema.sql          # 数据库结构定义
├── docs/               # 项目文档
│   ├── design/         # 核心设计文档
│   ├── process/        # 项目管理文档
│   └── archive/        # 历史文档归档
└── README.md           # 项目说明
```

## 6. 开发与部署

### 6.1 环境要求
- Python 3.8+
- 现代网页浏览器（Chrome、Firefox、Safari、Edge等）

### 6.2 安装与运行

```bash
# 克隆仓库
git clone https://github.com/yourusername/home_photo.git
cd home_photo

# 创建Python虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate     # Windows

# 安装依赖
pip install -r requirements.txt

# 初始化数据库
flask --app app init-db

# 运行服务器（开发环境）
python app.py

# 运行服务器（生产环境）
gunicorn -w 4 'app:create_app("production")'
```

### 6.3 开发规范

#### 6.3.1 分支策略
项目采用简化的 Git Flow 工作流：

- `main`: 生产环境代码，只接受来自`release`或`hotfix`分支的合并
- `develop`: 开发环境代码，所有功能开发完成后合并到此分支
- `feature/xxx`: 功能开发分支，从`develop`分支创建，开发完成后合并回`develop`
- `bugfix/xxx`: 错误修复分支，从`develop`分支创建，修复完成后合并回`develop`
- `release/vX.Y`: 版本发布准备分支，从`develop`分支创建，准备完成后合并到`main`和`develop`
- `hotfix/xxx`: 生产环境紧急修复分支，从`main`分支创建，修复完成后合并到`main`和`develop`

#### 6.3.2 提交规范
所有代码提交必须遵循约定式提交规范：

```
<type>(<scope>): <subject>

<body>

<footer>
```

- **type**: 提交类型，必须是以下之一：
  - `feat`: 新功能
  - `fix`: bug修复
  - `docs`: 文档更新
  - `style`: 代码格式调整
  - `refactor`: 代码重构
  - `test`: 测试相关
  - `chore`: 构建或工具变动

- **scope**: 变更范围，如`auth`, `family`, `photo`, `album`等

- **subject**: 简短描述，不超过50个字符

- **body**: 详细描述，可选

- **footer**: 关闭Issue或Breaking Changes说明，可选

示例:
```
feat(auth): 实现手机验证码登录功能

- 添加短信验证码发送接口
- 添加验证码验证逻辑
- 添加用户会话管理

Closes #123
```

#### 6.3.3 代码风格
- **Python**: 遵循PEP 8规范
- **JavaScript**: 遵循一致的缩进和命名规范
- **CSS**: 使用类名前缀避免冲突

#### 6.3.4 测试策略
- **单元测试**: 测试独立的函数和类，位于`tests/unit/`目录
- **集成测试**: 测试多个组件的交互，位于`tests/integration/`目录
- **端到端测试**: 测试完整的用户流程，位于`tests/e2e/`目录
- **测试覆盖率目标**: 核心功能模块覆盖率不低于80%

### 6.4 部署策略

#### 6.4.1 开发环境
- 直接运行`python app.py`
- 使用SQLite数据库
- DEBUG模式开启
- 日志级别：DEBUG

#### 6.4.2 测试环境
- 使用Gunicorn作为WSGI服务器
- 使用SQLite数据库
- DEBUG模式关闭
- 日志级别：INFO

#### 6.4.3 生产环境
- 使用Gunicorn/uWSGI + Nginx
- 使用SQLite数据库（小型部署）或PostgreSQL（大型部署）
- DEBUG模式关闭
- 日志级别：WARNING
- HTTPS加密

## 7. 版本规划

### 7.1 V0.1 MVP
- 用户认证模块（手机号登录/注册）
- 家庭管理模块（创建/加入家庭）
- 照片管理模块（上传/浏览/全屏查看）
- 相册管理模块（创建/编辑/照片归类）

### 7.2 V0.2 扩展功能
- 标签功能（创建/管理/照片打标签）
- 智能检索（按时间/上传者/关键词）
- 照片删除功能
- 性能优化（缓存/懒加载）

### 7.3 V0.3 高级功能
- AI人脸识别与自动归类
- 基于内容的智能检索
- 照片评论与互动
- 高级数据分析与统计

## 8. 项目文档

详细的项目文档位于 `docs/` 目录下，按功能分为三个子目录：

### 8.1 核心设计文档 (docs/design/)
- [产品需求文档 (PRD)](docs/design/PRD.md)
- [API接口文档](docs/design/API.md)
- [架构设计文档](docs/design/ARCHITECTURE.md)
- [实体关系设计](docs/design/ERD.md)
- [技术需求文档](docs/design/TRD.md)
- [界面设计规范](docs/design/UI.md)

### 8.2 项目管理文档 (docs/process/)
- [开发任务清单](docs/process/TODOLIST.md)
- [开发工作流](docs/process/DEVELOPMENT-WORKFLOW.md)
- [开发日志](docs/process/LOGS.md)
- [目录结构规范](docs/process/DIRECTORY-STRUCTURE.md)
- [重构计划](docs/process/REFACTORING-PLAN.md)

### 8.3 历史文档 (docs/archive/)
此目录包含所有历史版本的文档，用于追溯项目演变过程。

## 9. 安全与隐私

### 9.1 数据加密
- 所有API通信采用HTTPS加密传输
- 存储在文件系统中的照片数据支持加密选项
- 用户敏感信息（如手机号）在数据库中脱敏存储

### 9.2 访问控制
- 严格的家庭资源隔离，确保用户只能访问自己所在家庭的照片
- 身份认证状态有效期为30天，超时需重新登录
- 对敏感操作（如批量删除）需要二次验证

### 9.3 防滥用措施
- 短信验证码发送频率限制：同一手机号60秒内只能请求一次
- 24小时内同一手机号最多发送10条验证码
- 照片上传限制：每个用户每天最多上传100张照片

## 10. 性能优化

### 10.1 前端优化
- 图片懒加载
- 资源压缩与合并
- 浏览器缓存策略

### 10.2 后端优化
- 数据库索引优化
- 查询缓存
- 异步任务处理

### 10.3 存储优化
- 照片缩略图生成与缓存
- 分级存储策略
- 定期清理临时文件

## 11. 联系方式

项目维护者：技术团队

项目链接：[https://github.com/yourusername/home_photo](https://github.com/yourusername/home_photo)

---

最后更新: 2025-07-15 | 版本: V1.3 